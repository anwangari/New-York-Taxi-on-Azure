{
	"name": "DB2-combine_yellow-and-green-PROCEDURE",
	"properties": {
		"content": {
			"query": "IF EXISTS (SELECT * FROM sys.objects WHERE type = 'P' AND name = 'combine_green_and_yellow')\nBEGIN\n    DROP PROCEDURE dbo.combine_green_and_yellow;\nEND;\nGO\n\n\nCREATE PROCEDURE dbo.combine_green_and_yellow\nAS\nBEGIN\n    -- Check if the combined_taxi_trips_staged table exists\n    IF NOT EXISTS (SELECT * FROM sys.tables WHERE name = 'combined_taxi_trips_staged' AND schema_id = SCHEMA_ID('dbo'))\n    BEGIN\n        CREATE TABLE dbo.combined_taxi_trips_staged\n        WITH\n        (\n            DISTRIBUTION = ROUND_ROBIN,\n            CLUSTERED COLUMNSTORE INDEX\n        )\n        AS\n        SELECT \n            VendorID,\n            pickup_datetime,\n            dropoff_datetime,\n            passenger_count,\n            trip_distance,\n            RatecodeID,\n            store_and_fwd_flag,\n            PULocationID,\n            DOLocationID,\n            payment_type,\n            fare_amount,\n            extra,\n            mta_tax,\n            tip_amount,\n            tolls_amount,\n            improvement_surcharge,\n            total_amount,\n            congestion_surcharge,\n            service\n        FROM (\n            SELECT \n                VendorID,\n                lpep_pickup_datetime AS pickup_datetime,\n                lpep_dropoff_datetime AS dropoff_datetime,\n                passenger_count,\n                trip_distance,\n                RatecodeID,\n                store_and_fwd_flag,\n                PULocationID,\n                DOLocationID,\n                payment_type,\n                fare_amount,\n                extra,\n                mta_tax,\n                tip_amount,\n                tolls_amount,\n                improvement_surcharge,\n                total_amount,\n                congestion_surcharge,\n                'green' AS service\n            FROM dbo.green_taxi_data_CLEAN\n            UNION ALL\n            SELECT \n                VendorID,\n                tpep_pickup_datetime AS pickup_datetime,\n                tpep_dropoff_datetime AS dropoff_datetime,\n                passenger_count,\n                trip_distance,\n                RatecodeID,\n                store_and_fwd_flag,\n                PULocationID,\n                DOLocationID,\n                payment_type,\n                fare_amount,\n                extra,\n                mta_tax,\n                tip_amount,\n                tolls_amount,\n                improvement_surcharge,\n                total_amount,\n                congestion_surcharge,\n                'yellow' AS service\n            FROM dbo.yellow_taxi_data_staged\n        ) AS combined_trips_data\n    END\nEND",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "NewYorkTaxiDB2",
				"poolName": "NewYorkTaxiDB2"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}